<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Token Test</title>

  <link
    href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
    rel="stylesheet"
  />

  <style>
    body { margin: 0; }
    #map { width: 100vw; height: 100vh; }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

<script>
  /* ---------- MAPBOX (PUBLIC, OK) ---------- */
  mapboxgl.accessToken = "pk.eyJ1IjoibW9uYW1jY29ybWljayIsImEiOiJjbWs5c25rcmcwNmwyM2NwenB3d21kZGFzIn0.sTsW8a-JPa6n15Acuugg-Q";

  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/mapbox/streets-v11",
    center: [-96, 37],
    zoom: 4
  });

  function addPins(points) {
    points.forEach(p => {
      new mapboxgl.Marker()
        .setLngLat([p.lng, p.lat])
        .setPopup(new mapboxgl.Popup().setText(p.name))
        .addTo(map);
    });
  }

  /* ---------- DATA (ZOHO ONLY) ---------- */
  const API_URL = "https://mapapi-monamccormick.pythonanywhere.com/map/accounts";

  if (window.ZOHO) {
    ZOHO.embeddedApp.on("PageLoad", function () {
      ZOHO.CRM.API.getAccessToken().then(function (res) {
        const token = res.access_token;

        fetch(API_URL, {
          headers: {
            "Authorization": "Zoho-oauthtoken " + token
          }
        })
        .then(r => r.json())
        .then(points => {
          console.log("pins:", points);
          addPins(points);
        });
      });
    });
    ZOHO.embeddedApp.init();
  }
if (window.ZOHO) {
  ZOHO.embeddedApp.on("PageLoad", function () {
    console.log("ZOHO object detected");

    ZOHO.CRM.API.getAccessToken().then(function (res) {
      console.log("Zoho token response:", res);
      console.log("Access token value:", res && res.access_token);
    }).catch(function (err) {
      console.error("Zoho token error:", err);
    });
  });
  ZOHO.embeddedApp.init();
}

  
</script>



</body>
</html>
