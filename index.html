<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Lead Account Map</title>

  <!-- Mapbox -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link
    href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
    rel="stylesheet"
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    /* =======================
       MAPBOX INITIALIZATION
       ======================= */

    mapboxgl.accessToken = "pk.eyJ1IjoibW9uYW1jY29ybWljayIsImEiOiJjbWs5c25rcmcwNmwyM2NwenB3d21kZGFzIn0.sTsW8a-JPa6n15Acuugg-Q";

    const map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/streets-v11",
      center: [-98, 39],
      zoom: 4
    });

    /* =======================
       PIN RENDERING
       ======================= */

    function renderPins(pins) {
      if (!Array.isArray(pins)) return;

      pins.forEach(p => {
        if (!p.lat || !p.lng) return;

        new mapboxgl.Marker()
          .setLngLat([p.lng, p.lat])
          .setPopup(
            new mapboxgl.Popup({ offset: 25 }).setText(p.name || "")
          )
          .addTo(map);
      });
    }

    /* =======================
       RECEIVE DATA FROM ZOHO
       ======================= */

    window.addEventListener("message", function (event) {
      if (!event.data) return;
      if (event.data.type !== "ACCOUNT_PINS") return;

      renderPins(event.data.data);
    });
  </script>
</body>
</html>
